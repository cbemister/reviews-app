var RUMSpeedIndex=function(e){e=e||window;var t,n,r=e.document,i=function(t){var n=!1;if(t.getBoundingClientRect){var i=t.getBoundingClientRect();n={top:Math.max(i.top,0),left:Math.max(i.left,0),bottom:Math.min(i.bottom,e.innerHeight||r.documentElement.clientHeight),right:Math.min(i.right,e.innerWidth||r.documentElement.clientWidth)},n.bottom>n.top&&n.right>n.left?n.area=(n.bottom-n.top)*(n.right-n.left):n=!1}return n},a=function(e,t){if(t){var n=i(e);n&&d.push({url:t,area:n.area,rect:n})}},o=function(){for(var t=r.getElementsByTagName("*"),n=/url\(.*(http.*)\)/gi,o=0;o<t.length;o++){var m=t[o],c=e.getComputedStyle(m);if("IMG"==m.tagName&&a(m,m.src),c["background-image"]){n.lastIndex=0;var f=n.exec(c["background-image"]);f&&f.length>1&&a(m,f[1].replace('"',""))}if("IFRAME"==m.tagName)try{var s=i(m);if(s){var h=RUMSpeedIndex(m.contentWindow);h&&d.push({tm:h,area:s.area,rect:s})}}catch(g){}}},m=function(){for(var t={},n=e.performance.getEntriesByType("resource"),r=0;r<n.length;r++)t[n[r].name]=n[r].responseEnd;for(var i=0;i<d.length;i++)"tm"in d[i]||(d[i].tm=void 0!==t[d[i].url]?t[d[i].url]:0)},c=function(){if("msFirstPaint"in e.performance.timing&&(t=e.performance.timing.msFirstPaint-l),"chrome"in e&&"loadTimes"in e.chrome){var n=e.chrome.loadTimes();if("firstPaintTime"in n&&n.firstPaintTime>0){var i=n.startLoadTime;"requestTime"in n&&(i=n.requestTime),n.firstPaintTime<i||(t=1e3*(n.firstPaintTime-i))}}if(void 0===t||0>t||t>12e4){t=e.performance.timing.responseStart-l;for(var a={},o=r.getElementsByTagName("head")[0].children,m=0;m<o.length;m++){var c=o[m];"SCRIPT"==c.tagName&&c.src&&!c.async&&(a[c.src]=!0),"LINK"==c.tagName&&"stylesheet"==c.rel&&c.href&&(a[c.href]=!0)}for(var f=e.performance.getEntriesByType("resource"),s=!1,d=0;d<f.length;d++)if(s||!a[f[d].name]||"script"!=f[d].initiatorType&&"link"!=f[d].initiatorType)s=!0;else{var h=f[d].responseEnd;(void 0===t||h>t)&&(t=h)}}t=Math.max(t,0)},f=function(){for(var n={0:0},i=0,a=0;a<d.length;a++){var o=t;"tm"in d[a]&&d[a].tm>t&&(o=d[a].tm),void 0===n[o]&&(n[o]=0),n[o]+=d[a].area,i+=d[a].area}var m=Math.max(r.documentElement.clientWidth,e.innerWidth||0)*Math.max(r.documentElement.clientHeight,e.innerHeight||0);if(m>0&&(m=Math.max(m-i,0)*g,void 0===n[t]&&(n[t]=0),n[t]+=m,i+=m),i){for(var c in n)n.hasOwnProperty(c)&&h.push({tm:c,area:n[c]});h.sort(function(e,t){return e.tm-t.tm});for(var f=0,s=0;s<h.length;s++)f+=h[s].area,h[s].progress=f/i}},s=function(){if(h.length){n=0;for(var e=0,r=0,i=0;i<h.length;i++){var a=h[i].tm-e;a>0&&1>r&&(n+=(1-r)*a),e=h[i].tm,r=h[i].progress}}else n=t},d=[],h=[],g=.1;try{var l=e.performance.timing.navigationStart;o(),m(),c(),f(),s()}catch(u){}return n};"undefined"!=typeof module&&module.exports&&(module.exports=RUMSpeedIndex),function(e){if(e){var t=Math.round(RUMSpeedIndex());t&&window.addEventListener("DOMContentLoaded",function(){e.setCustomAttribute("firstPaintDuration",t/1e3)})}}(window.newrelic);
